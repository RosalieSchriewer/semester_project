<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="stylesheet" id="themeStylesheet" href="/styles/light-theme.css">
</head>

<body>
    <div id="notificationPopup" class="notification-popup hidden">
        <span id="notificationText"></span>
    </div>
   
    <img class="thumbnail" style="display: none;" src="./avatarStudio/media/eyebrowRender.jpg" id="loadEyebrows2Button">
    <img class="thumbnail" style="display: none;" src="./avatarStudio/media/eyebrow-1Render.jpg"
        id="loadEyebrowsButton">

    <h1>Your friend shared their avatar with you</h1>

</body>


<script type="module">

    import { loadScene } from "./avatarStudio/script/main.mjs";
    import { avatarData } from "./avatarStudio/script/scene.mjs";
    import { handleFetchError,HTTPError } from "./modules/errorHandler.mjs"
    loadScene()





    loadData()
    async function loadData() {

        const token = new URLSearchParams(window.location.search).get("token");

        try {


            let response = await fetch("/user/decodeSharedAvatar", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token }),

            });

            if (response.status != HTTPError.Ok) {
                throw new Error("Server error: " + response.status);
            } else {
                let data = await response.json();
                
                localStorage.setItem("userHairColor", data.hairColor);
                localStorage.setItem("userSkinColor", data.skinColor);
                localStorage.setItem("userEyeColor", data.eyeColor);
                localStorage.setItem("userEyebrowType", data.eyebrowType);


            }
        } catch (error) {
            handleFetchError(error)
            console.error("The error is: " + error);
        }
    }


</script>

</html>