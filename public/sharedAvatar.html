<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link rel="stylesheet" id="themeStylesheet" href="/styles/light-theme.css">
</head>

<body>
    <div id="notificationPopup" class="notification-popup hidden">
        <span id="notificationText"></span>
    </div>
    <button id="lightModeBtn">Darkmode</button>
    <img class="thumbnail" style="display: none;" src="./AvatarStudio/Media/eyebrowRender.jpg" id="loadEyebrows2Button">
    <img class="thumbnail" style="display: none;" src="./AvatarStudio/Media/eyebrow-1Render.jpg"
        id="loadEyebrowsButton">

    <h1>Your friend shared their avatar with you</h1>

</body>


<script type="module">

    import { loadScene } from "./AvatarStudio/Script/main.js";
    import { avatarData } from "./AvatarStudio/Script/scene.js";
    loadScene()

    let lightModeBtn = document.getElementById("lightModeBtn")
    lightModeBtn.addEventListener("click", function () {
        const themeStylesheet = document.getElementById("themeStylesheet");

        // Toggle between dark and light themes
        if (themeStylesheet.href.includes("dark")) {
            lightModeBtn.textContent = "Darkmode"
            themeStylesheet.href = "/styles/light-theme.css";


        } else {
            lightModeBtn.textContent = "Lightmode"
            themeStylesheet.href = "/styles/dark.theme.css";
        }
    });

    const token = new URLSearchParams(window.location.search).get("token");

    loadData()
    async function loadData() {

        const token = new URLSearchParams(window.location.search).get("token");

        try {


            let response = await fetch("/user/decodeSharedAvatar", {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ token }),

            });

            if (response.status != 200) {
                throw new Error("Server error: " + response.status);
            } else {
                let data = await response.json();
                console.log(data);
                let sharedAvatar = true
                localStorage.setItem("sharedAvatar", sharedAvatar)
                localStorage.setItem("userHairColor", data.hairColor);
                localStorage.setItem("userSkinColor", data.skinColor);
                localStorage.setItem("userEyeColor", data.eyeColor);
                localStorage.setItem("userEyebrowType", data.eyebrowType);


            }
        } catch (error) {
            console.error("The error is: " + error);
        }
    }


</script>

</html>